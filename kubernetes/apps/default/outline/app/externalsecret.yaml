---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &app outline
  namespace: default
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: outline-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # S3
        AWS_ACCESS_KEY_ID: "{{ .OUTLINE_AWS_ACCESS_KEY_ID }}"
        AWS_SECRET_ACCESS_KEY: "{{ .OUTLINE_AWS_SECRET_ACCESS_KEY }}"
        # App
        UTILS_SECRET: "{{ .OUTLINE_UTILS_SECRET }}"
        SECRET_KEY: "{{ .OUTLINE_SECRET_KEY }}"
        OIDC_CLIENT_ID: "{{ .OUTLINE_OAUTH_CLIENT_ID }}"
        OIDC_CLIENT_SECRET: "{{ .OUTLINE_OAUTH_CLIENT_SECRET }}"
        URL: "https://outline.tslamars.com"
        LOG_LEVEL: debug
        ENABLE_UPDATES: false
        AWS_REGION: main
        AWS_S3_ACL: private
        AWS_S3_FORCE_PATH_STYLE: "true"
        AWS_S3_UPLOAD_BUCKET_NAME: outline
        AWS_S3_UPLOAD_BUCKET_URL: "https://s3.tslamars.com"
        FILE_STORAGE: s3
        FILE_STORAGE_UPLOAD_MAX_SIZE: "26214400"
        FILE_STORAGE_IMPORT_MAX_SIZE: "26214400"
        PORT: 8080
        REDIS_URL: redis://outline-dragonfly.default.svc.cluster.local:6379
        SMTP_HOST: smtp-relay.default.svc.cluster.local.
        SMTP_PORT: 2525
        SMTP_FROM_EMAIL: "outline@tslamars.com"
        SMTP_SECURE: false
        WEB_CONCURRENCY: 10
        EMAIL_ENABLED: "true"
        NODE_TLS_REJECT_UNAUTHORIZED: "0"
        OIDC_DISPLAY_NAME: authentik
        OIDC_SCOPES: openid profile email
        OIDC_AUTH_URI: "https://sso.tslamars.com/application/o/authorize/"
        OIDC_TOKEN_URI: "https://sso.tslamars.com/application/o/token/"
        OIDC_USERINFO_URI: "https://sso.tslamars.com/application/o/userinfo/"
        OIDC_USERNAME_CLAIM: preferred_username
        OIDC_LOGOUT_URI: "https://sso.tslamars.com/application/o/outline/end-session/"
        OIDC_REDIRECT_URI: "https://outline.tslamars.com/auth/oidc-callback"
  dataFrom:
    - extract:
        key: *app
    #- extract:
    #    key: minio
